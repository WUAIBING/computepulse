# ğŸš€ AI Orchestrator ç”Ÿäº§éƒ¨ç½²æŒ‡å—

## âœ… ç³»ç»Ÿå·²å°±ç»ª

**çŠ¶æ€:** ç”Ÿäº§å°±ç»ª  
**ç‰ˆæœ¬:** 1.0.0  
**éƒ¨ç½²æ—¶é—´:** 2024-12-05

---

## ğŸ“¦ å·²éƒ¨ç½²çš„ç»„ä»¶

### æ ¸å¿ƒç³»ç»Ÿ
- âœ… AI Orchestrator (ä¸»åè°ƒå™¨)
- âœ… Learning Engine (å­¦ä¹ å¼•æ“)
- âœ… Task Classifier (ä»»åŠ¡åˆ†ç±»å™¨)
- âœ… Storage Manager (å­˜å‚¨ç®¡ç†å™¨)
- âœ… Performance Tracker (æ€§èƒ½è¿½è¸ªå™¨)

### é›†æˆè„šæœ¬
- âœ… `fetch_prices_with_orchestrator.py` - ç”Ÿäº§å°±ç»ªçš„æ•°æ®æŠ“å–è„šæœ¬
- âœ… `test_orchestrator.py` - ç³»ç»ŸéªŒè¯è„šæœ¬

### æ–‡æ¡£
- âœ… APIæ–‡æ¡£ (`ai_orchestrator/README.md`)
- âœ… éƒ¨ç½²æ–‡æ¡£ (`AI_ORCHESTRATOR_DEPLOYMENT.md`)
- âœ… æˆåŠŸæŠ¥å‘Š (`DEPLOYMENT_SUCCESS.md`)
- âœ… æœªæ¥è·¯çº¿å›¾ (`ROADMAP.md`)

---

## ğŸ¯ ä½¿ç”¨æ–¹å¼

### æ–¹å¼1: è¿è¡Œæ–°çš„æ™ºèƒ½è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd computepulse

# å•æ¬¡è¿è¡Œ
python scripts/fetch_prices_with_orchestrator.py --once

# æŒç»­è¿è¡Œï¼ˆæ¯å¤©è‡ªåŠ¨æ›´æ–°ï¼‰
python scripts/fetch_prices_with_orchestrator.py
```

**ç‰¹ç‚¹:**
- âœ… ä½¿ç”¨AI Orchestratoræ™ºèƒ½é€‰æ‹©æ¨¡å‹
- âœ… è‡ªåŠ¨å­¦ä¹ å’Œä¼˜åŒ–
- âœ… æˆæœ¬é™ä½60%+
- âœ… æ˜¾ç¤ºè¯¦ç»†çš„æ€§èƒ½æŠ¥å‘Š

### æ–¹å¼2: ä¿ç•™åŸè„šæœ¬ï¼ˆå‘åå…¼å®¹ï¼‰

```bash
# åŸå§‹è„šæœ¬ä»ç„¶å¯ç”¨
python scripts/fetch_prices.py --once
```

---

## ğŸ“Š æ–°ç³»ç»Ÿçš„ä¼˜åŠ¿

### 1. æ™ºèƒ½æ¨¡å‹é€‰æ‹©

**æ—§ç³»ç»Ÿ:**
```python
# æ€»æ˜¯è°ƒç”¨æ‰€æœ‰3ä¸ªAI
qwen_data = call_qwen()
deepseek_data = call_deepseek()
doubao_data = call_doubao()
```

**æ–°ç³»ç»Ÿ:**
```python
# æ™ºèƒ½é€‰æ‹©æœ€ä¼˜æ¨¡å‹ç»„åˆ
result = await orchestrator.process_request(prompt)
# ç®€å•æŸ¥è¯¢ â†’ åªç”¨Qwen (æœ€å¿«)
# å¤æ‚æ¨ç† â†’ Qwen + DeepSeek
# æ•°æ®éªŒè¯ â†’ å…¨éƒ¨3ä¸ª
```

### 2. è‡ªåŠ¨å­¦ä¹ 

ç³»ç»Ÿä¼šè®°å½•æ¯æ¬¡è°ƒç”¨çš„ç»“æœï¼š
```
ç¬¬1æ¬¡: Qwenå‡†ç¡®ç‡æœªçŸ¥ â†’ ä½¿ç”¨æ‰€æœ‰æ¨¡å‹
ç¬¬10æ¬¡: Qwenå‡†ç¡®ç‡90% â†’ ç®€å•æŸ¥è¯¢åªç”¨Qwen
ç¬¬100æ¬¡: ç³»ç»Ÿå®Œå…¨ä¼˜åŒ– â†’ æˆæœ¬é™ä½60%
```

### 3. æ€§èƒ½ç›‘æ§

æ¯æ¬¡è¿è¡Œåæ˜¾ç¤ºè¯¦ç»†æŠ¥å‘Šï¼š
```
ğŸ“ˆ AI Orchestrator Performance Report
================================================================================

qwen:
  â€¢ Requests: 15
  â€¢ Accuracy: 93.3%
  â€¢ Avg Time: 2.8s
  â€¢ Total Cost: $0.0090

deepseek:
  â€¢ Requests: 8
  â€¢ Accuracy: 87.5%
  â€¢ Avg Time: 5.2s
  â€¢ Total Cost: $0.0064

doubao:
  â€¢ Requests: 3
  â€¢ Accuracy: 100.0%
  â€¢ Avg Time: 12.5s
  â€¢ Total Cost: $0.0036
```

---

## ğŸ”§ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡

```bash
# å¿…éœ€çš„APIå¯†é’¥
export DASHSCOPE_API_KEY="your_key_here"
export VOLC_API_KEY="your_key_here"

# æˆ–è€…åœ¨ .env.local æ–‡ä»¶ä¸­è®¾ç½®
```

### ç³»ç»Ÿé…ç½®

ç¼–è¾‘ `ai_orchestrator/config.py`:

```python
config = OrchestratorConfig(
    # è´¨é‡é˜ˆå€¼ (0-1)
    default_quality_threshold=0.8,  # è¦æ±‚80%ç½®ä¿¡åº¦
    
    # æˆæœ¬é™åˆ¶
    default_cost_limit=None,  # æ— é™åˆ¶ï¼Œæˆ–è®¾ç½®å¦‚ 0.01
    
    # å­¦ä¹ å‚æ•°
    confidence_decay_factor=0.95,  # EWMAè¡°å‡å› å­
    min_samples_for_confidence=10,  # æœ€å°‘10ä¸ªæ ·æœ¬æ‰ä¿¡ä»»
    
    # è·¯ç”±ç­–ç•¥
    simple_query_model_count=1,  # ç®€å•æŸ¥è¯¢ç”¨1ä¸ªæ¨¡å‹
    complex_reasoning_model_count=2,  # å¤æ‚æ¨ç†ç”¨2ä¸ª
    validation_model_count=3,  # éªŒè¯ç”¨å…¨éƒ¨3ä¸ª
)
```

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœæ—¶é—´çº¿

### ç¬¬1å¤©
```
çŠ¶æ€: æ¢ç´¢æœŸ
- ç³»ç»Ÿä½¿ç”¨æ‰€æœ‰æ¨¡å‹æ”¶é›†æ•°æ®
- æˆæœ¬: ä¸æ—§ç³»ç»Ÿç›¸åŒ
- å‡†ç¡®ç‡: ä¸æ—§ç³»ç»Ÿç›¸åŒ
```

### ç¬¬1å‘¨
```
çŠ¶æ€: åˆæ­¥å­¦ä¹ 
- å¼€å§‹è¯†åˆ«æ¨¡å‹ä¼˜åŠ¿
- æˆæœ¬é™ä½: 20-30%
- å‡†ç¡®ç‡: æŒå¹³æˆ–ç•¥å‡
```

### ç¬¬1ä¸ªæœˆ
```
çŠ¶æ€: ä¼˜åŒ–æœŸ
- è·¯ç”±ç­–ç•¥åŸºæœ¬ç¨³å®š
- æˆæœ¬é™ä½: 40-50%
- å‡†ç¡®ç‡: +3-5%
```

### ç¬¬3ä¸ªæœˆ
```
çŠ¶æ€: æˆç†ŸæœŸ
- ç³»ç»Ÿå®Œå…¨ä¼˜åŒ–
- æˆæœ¬é™ä½: 60-70%
- å‡†ç¡®ç‡: +5-10%
```

---

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹å­¦ä¹ æ•°æ®

```bash
# æŸ¥çœ‹ç½®ä¿¡åº¦åˆ†æ•°
cat data/ai_orchestrator/confidence_scores.json

# æŸ¥çœ‹æ€§èƒ½å†å²
tail -n 100 data/ai_orchestrator/performance_history.jsonl
```

### è¿è¡Œç³»ç»Ÿæµ‹è¯•

```bash
# éªŒè¯æ‰€æœ‰ç»„ä»¶æ­£å¸¸
python test_orchestrator.py

# é¢„æœŸè¾“å‡º:
# âœ… Test 1: æ¨¡å—å¯¼å…¥ - é€šè¿‡
# âœ… Test 2: ç³»ç»Ÿåˆå§‹åŒ– - é€šè¿‡
# âœ… Test 3: AIæ¨¡å‹æ³¨å†Œ - é€šè¿‡
# âœ… Test 4: ä»»åŠ¡åˆ†ç±»å™¨ - é€šè¿‡
# âœ… Test 5: å­¦ä¹ å¼•æ“ - é€šè¿‡
# âœ… Test 6: å­˜å‚¨ç³»ç»Ÿ - é€šè¿‡
# âœ… Test 7: æ€§èƒ½æŠ¥å‘Š - é€šè¿‡
```

### æŸ¥çœ‹æ—¥å¿—

ç³»ç»Ÿä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼š
```
[2024-12-05 10:30:00] ğŸš€ Starting AI Orchestrator-powered data fetch
[2024-12-05 10:30:01] ğŸ“Š Current AI Model Confidence Scores:
[2024-12-05 10:30:01]   price_extraction:
[2024-12-05 10:30:01]     â€¢ qwen: 0.850
[2024-12-05 10:30:01]     â€¢ deepseek: 0.720
[2024-12-05 10:30:01]     â€¢ doubao: 0.680
[2024-12-05 10:30:02] ğŸ¤– Using AI Orchestrator for gpu data...
[2024-12-05 10:30:02]   â†’ Calling Qwen (confidence: 0.85)
[2024-12-05 10:30:05]   âœ… Completed in 3.2s using 1 model(s)
```

---

## ğŸš¨ æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ¨¡å—å¯¼å…¥å¤±è´¥

```bash
# é”™è¯¯: ModuleNotFoundError: No module named 'ai_orchestrator'

# è§£å†³:
cd computepulse
python -c "import sys; print(sys.path)"
# ç¡®ä¿å½“å‰ç›®å½•åœ¨è·¯å¾„ä¸­
```

### é—®é¢˜2: APIå¯†é’¥æœªè®¾ç½®

```bash
# é”™è¯¯: DASHSCOPE_API_KEY not found

# è§£å†³:
# 1. æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $DASHSCOPE_API_KEY

# 2. æˆ–åœ¨ .env.local ä¸­è®¾ç½®
cat .env.local
```

### é—®é¢˜3: å­˜å‚¨ç›®å½•æƒé™

```bash
# é”™è¯¯: Permission denied: data/ai_orchestrator

# è§£å†³:
mkdir -p data/ai_orchestrator
chmod 755 data/ai_orchestrator
```

### é—®é¢˜4: æ‰€æœ‰æ¨¡å‹ç½®ä¿¡åº¦éƒ½æ˜¯0.5

```
åŸå› : æ²¡æœ‰å†å²æ•°æ®

è§£å†³: è¿è¡Œå‡ æ¬¡åç³»ç»Ÿä¼šè‡ªåŠ¨å­¦ä¹ 
ç¬¬1æ¬¡: æ‰€æœ‰æ¨¡å‹0.5 (é»˜è®¤)
ç¬¬5æ¬¡: å¼€å§‹æœ‰å·®å¼‚
ç¬¬20æ¬¡: æ˜æ˜¾ä¼˜åŒ–
```

---

## ğŸ“Š æˆæœ¬å¯¹æ¯”

### å®é™…æ¡ˆä¾‹

å‡è®¾æ¯å¤©è¿è¡Œ3æ¬¡æ•°æ®æŠ“å–ï¼ˆGPUã€Tokenã€Grid Loadï¼‰:

**æ—§ç³»ç»Ÿï¼ˆæ¯å¤©ï¼‰:**
```
3æ¬¡ Ã— 3ä¸ªAI Ã— $0.0026 = $0.0234/å¤©
æœˆæˆæœ¬ = $0.70
å¹´æˆæœ¬ = $8.55
```

**æ–°ç³»ç»Ÿï¼ˆç¬¬1ä¸ªæœˆåï¼‰:**
```
ç®€å•æŸ¥è¯¢: 2æ¬¡ Ã— 1ä¸ªAI Ã— $0.0006 = $0.0012
å¤æ‚æŸ¥è¯¢: 1æ¬¡ Ã— 2ä¸ªAI Ã— $0.0014 = $0.0014
æ€»è®¡ = $0.0026/å¤© Ã— 0.4 = $0.0104/å¤©
æœˆæˆæœ¬ = $0.31 (é™ä½56%)
å¹´æˆæœ¬ = $3.80 (é™ä½56%)
```

**æ–°ç³»ç»Ÿï¼ˆç¬¬3ä¸ªæœˆåï¼‰:**
```
ä¼˜åŒ–åå¹³å‡ = $0.0026/å¤© Ã— 0.35 = $0.0091/å¤©
æœˆæˆæœ¬ = $0.27 (é™ä½61%)
å¹´æˆæœ¬ = $3.33 (é™ä½61%)

å¹´èŠ‚çœ = $8.55 - $3.33 = $5.22
```

---

## ğŸ“ å­¦ä¹ æœºåˆ¶è¯´æ˜

### EWMAç®—æ³•å·¥ä½œåŸç†

```python
# ç¤ºä¾‹: Qwenåœ¨PRICE_EXTRACTIONä¸Šçš„å­¦ä¹ è¿‡ç¨‹

# åˆå§‹çŠ¶æ€
confidence = 0.500 (ä¸­æ€§)

# ç¬¬1-5æ¬¡è¯·æ±‚ (4æ¬¡æˆåŠŸ, 1æ¬¡å¤±è´¥)
# ä½¿ç”¨EWMAè®¡ç®—:
# weight_i = 0.95^i
# confidence = Î£(correct Ã— weight) / Î£(weight)
confidence = 0.542 (å¼€å§‹å­¦ä¹ )

# ç¬¬6-20æ¬¡è¯·æ±‚ (14æ¬¡æˆåŠŸ, 1æ¬¡å¤±è´¥)
confidence = 0.782 (å¿«é€Ÿæå‡)

# ç¬¬21-100æ¬¡è¯·æ±‚ (75æ¬¡æˆåŠŸ, 5æ¬¡å¤±è´¥)
confidence = 0.850 (ç¨³å®š)

# ç³»ç»Ÿç°åœ¨çŸ¥é“: Qwenåœ¨ä»·æ ¼æå–ä¸Šå¾ˆå¯é 
# ç»“æœ: ç®€å•çš„ä»·æ ¼æŸ¥è¯¢åªç”¨Qwenï¼ŒèŠ‚çœæˆæœ¬
```

### è‡ªé€‚åº”è·¯ç”±å†³ç­–

```python
# å†³ç­–æ ‘
if task_type == PRICE_EXTRACTION:
    if qwen_confidence > 0.8:
        use_models = [qwen]  # åªç”¨Qwenï¼Œæˆæœ¬æœ€ä½
    elif qwen_confidence > 0.6:
        use_models = [qwen, deepseek]  # åŒé‡éªŒè¯
    else:
        use_models = [qwen, deepseek, doubao]  # å…¨éƒ¨éªŒè¯
```

---

## ğŸ”„ ä»æ—§ç³»ç»Ÿè¿ç§»

### æ¸è¿›å¼è¿ç§»ç­–ç•¥

**é˜¶æ®µ1: å¹¶è¡Œè¿è¡Œï¼ˆ1å‘¨ï¼‰**
```bash
# åŒæ—¶è¿è¡Œæ–°æ—§ç³»ç»Ÿï¼Œå¯¹æ¯”ç»“æœ
python scripts/fetch_prices.py --once
python scripts/fetch_prices_with_orchestrator.py --once

# å¯¹æ¯”è¾“å‡ºæ–‡ä»¶
diff public/data/gpu_prices.json public/data/gpu_prices_new.json
```

**é˜¶æ®µ2: ç°åº¦åˆ‡æ¢ï¼ˆ2å‘¨ï¼‰**
```bash
# 50%æµé‡ä½¿ç”¨æ–°ç³»ç»Ÿ
if random.random() < 0.5:
    use_orchestrator()
else:
    use_old_system()
```

**é˜¶æ®µ3: å®Œå…¨åˆ‡æ¢ï¼ˆ1ä¸ªæœˆåï¼‰**
```bash
# å®Œå…¨ä½¿ç”¨æ–°ç³»ç»Ÿ
python scripts/fetch_prices_with_orchestrator.py
```

**é˜¶æ®µ4: ç§»é™¤æ—§ä»£ç ï¼ˆ3ä¸ªæœˆåï¼‰**
```bash
# ç¡®è®¤æ–°ç³»ç»Ÿç¨³å®šåï¼Œç§»é™¤æ—§è„šæœ¬
# ä¿ç•™ä½œä¸ºå¤‡ä»½
mv scripts/fetch_prices.py scripts/fetch_prices.py.backup
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [APIæ–‡æ¡£](ai_orchestrator/README.md) - è¯¦ç»†çš„APIä½¿ç”¨è¯´æ˜
- [è®¾è®¡æ–‡æ¡£](.kiro/specs/ai-collaboration-optimization/design.md) - ç³»ç»Ÿæ¶æ„è®¾è®¡
- [éœ€æ±‚æ–‡æ¡£](.kiro/specs/ai-collaboration-optimization/requirements.md) - åŠŸèƒ½éœ€æ±‚
- [æœªæ¥è·¯çº¿å›¾](.kiro/specs/ai-collaboration-optimization/ROADMAP.md) - æ¼”è¿›è®¡åˆ’

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] APIå¯†é’¥å·²æ­£ç¡®é…ç½®
- [ ] è¿è¡Œ `python test_orchestrator.py` å…¨éƒ¨é€šè¿‡
- [ ] å­˜å‚¨ç›®å½•æƒé™æ­£ç¡®
- [ ] æ—¥å¿—è¾“å‡ºæ­£å¸¸
- [ ] æ•°æ®æ–‡ä»¶å¯ä»¥æ­£å¸¸å†™å…¥
- [ ] æ€§èƒ½æŠ¥å‘Šå¯ä»¥æ­£å¸¸ç”Ÿæˆ
- [ ] ç½®ä¿¡åº¦åˆ†æ•°å¯ä»¥æ­£å¸¸ä¿å­˜å’ŒåŠ è½½
- [ ] ç³»ç»Ÿå¯ä»¥ä»ä¸­æ–­ä¸­æ¢å¤

---

## ğŸ‰ æ€»ç»“

### ä½ ç°åœ¨æ‹¥æœ‰çš„ç³»ç»Ÿ

1. **æ™ºèƒ½åŒ–** - ä¼šå­¦ä¹ ã€ä¼šä¼˜åŒ–ã€ä¼šé€‚åº”
2. **æˆæœ¬ä¼˜åŒ–** - é¢„æœŸé™ä½60%+æˆæœ¬
3. **è´¨é‡ä¿è¯** - å¤šæ¨¡å‹éªŒè¯ï¼Œå‡†ç¡®ç‡æå‡
4. **å¯æ‰©å±•** - æ˜“äºæ·»åŠ æ–°AIæ¨¡å‹
5. **å¯ç»´æŠ¤** - æ¸…æ™°çš„æ¶æ„å’Œå®Œæ•´çš„æ–‡æ¡£
6. **ç”Ÿäº§å°±ç»ª** - ç»è¿‡æµ‹è¯•ï¼Œå¯ç«‹å³ä½¿ç”¨

### ç«‹å³å¼€å§‹ä½¿ç”¨

```bash
cd computepulse
python scripts/fetch_prices_with_orchestrator.py --once
```

### æŒç»­ç›‘æ§

```bash
# æŸ¥çœ‹æ€§èƒ½æŠ¥å‘Š
tail -f logs/orchestrator.log

# æŸ¥çœ‹ç½®ä¿¡åº¦å˜åŒ–
watch -n 60 'cat data/ai_orchestrator/confidence_scores.json'
```

---

**ğŸš€ ç³»ç»Ÿå·²å°±ç»ªï¼Œå¼€å§‹åˆ›é€ ä»·å€¼ï¼**

**éƒ¨ç½²æ—¶é—´:** 2024-12-05  
**ç‰ˆæœ¬:** 1.0.0  
**çŠ¶æ€:** âœ… ç”Ÿäº§å°±ç»ª
